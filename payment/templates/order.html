<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Оплата заказа</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Оплата заказа №{{ order.id }}</h1>
    <p>К оплате: {{ order.total }}₽</p>
    <button id="checkout-button">Оплатить через Stripe</button>

    <script type="text/javascript">
      const stripe = Stripe("{{ stripe_public_key }}"); // Передайте API-ключ в контекст шаблона

      document.getElementById("checkout-button").addEventListener("click", function () {
        fetch("{% url 'create_stripe_session' order.id %}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
          },
          body: JSON.stringify({
            order_id: "{{ order.id }}"
          })
        })
        .then(response => response.json())
        .then(session => {
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .catch(error => {
          console.error("Ошибка:", error);
        });
      });
    </script>
    <a href="/">На главную</a>
</body>
</html>