<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ item.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-light">
<div class="container py-5">
    <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'cart' %}" class="btn btn-outline-primary me-2">
            Корзина
        </a>
        <button class="btn btn-link currency-btn {% if currency == 'usd' %}fw-bold{% endif %}" data-currency="usd">USD</button>
        <button class="btn btn-link currency-btn {% if currency == 'eur' %}fw-bold{% endif %}" data-currency="eur">EUR</button>
    </div>
    <div class="card shadow-lg mx-auto" style="max-width: 600px;">
        <div class="card-body">
            <h2 class="card-title">{{ item.name }}</h2>
            <p class="card-text fs-5">{{ item.description }}</p>
            <div class="d-flex justify-content-between align-items-center mt-4">
                <span class="fs-3 fw-bold">{{ display_price }} {{ currency|upper }}</span>
                <form method="post" action="{% url 'add_to_cart' item.id %}">
                    {% csrf_token %}
                    <button class="btn btn-outline-secondary me-2">В корзину</button>
                </form>
                <button id="buy-btn" class="btn btn-success btn-lg">Купить сейчас</button>
            </div>
        </div>
    </div>
    <a href="{% url 'index' %}" class="btn btn-link mt-4 d-block text-center">Назад к списку товаров</a>
</div>
<script>
    const stripe = Stripe("{{ stripe_public_key }}");
    document.getElementById("buy-btn").onclick = function() {
        fetch("{% url 'buy' item.id %}")
            .then(r => r.json())
            .then(data => {
                return stripe.redirectToCheckout({sessionId: data.session_id});
            });
    };
    document.querySelectorAll('.currency-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const currency = this.getAttribute('data-currency');
            const params = new URLSearchParams(window.location.search);
            params.set('currency', currency);
            window.location.search = params.toString();
        });
    });
</script>
</body>
</html>